"""Add stripe columns

Revision ID: 0036
Revises: 0035
Create Date: 2025-05-08 22:57:28.516338

"""

from collections.abc import Sequence

import sqlalchemy as sa
from alembic import op
from sqlalchemy.dialects import postgresql
from sqlmodel.sql.sqltypes import AutoString

# revision identifiers, used by Alembic.
revision: str = "0036"
down_revision: str | None = "0035"
branch_labels: str | Sequence[str] | None = None
depends_on: str | Sequence[str] | None = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    sa.Enum("FREE", "PRO", "TEAM", "ENTERPRISE", name="subscriptionplan").create(
        op.get_bind()
    )
    with op.batch_alter_table("organizations", schema=None) as batch_op:
        batch_op.add_column(
            sa.Column("stripe_customer_id", AutoString(), nullable=True)
        )
        batch_op.add_column(
            sa.Column("stripe_subscription_id", AutoString(), nullable=True)
        )
        batch_op.add_column(
            sa.Column(
                "subscription_plan",
                postgresql.ENUM(
                    "FREE",
                    "PRO",
                    "TEAM",
                    "ENTERPRISE",
                    name="subscriptionplan",
                    create_type=False,
                ),
                nullable=False,
                server_default="FREE",
            )
        )
        batch_op.add_column(
            sa.Column("subscription_status", AutoString(), nullable=True)
        )
        batch_op.add_column(
            sa.Column("subscription_current_period_end", sa.Integer(), nullable=True)
        )

    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    with op.batch_alter_table("organizations", schema=None) as batch_op:
        batch_op.drop_column("subscription_current_period_end")
        batch_op.drop_column("subscription_status")
        batch_op.drop_column("subscription_plan")
        batch_op.drop_column("stripe_subscription_id")
        batch_op.drop_column("stripe_customer_id")

    sa.Enum("FREE", "PRO", "TEAM", "ENTERPRISE", name="subscriptionplan").drop(
        op.get_bind()
    )
    # ### end Alembic commands ###
